<html>
<style>
    .foodiv {
      width: 100%;
    }
    
    .slider {
      -webkit-appearance: none;
      width: 100%;
      height: 25px;
      background: #d3d3d3;
      outline: none;
      opacity: 0.7;
      -webkit-transition: .2s;
      transition: opacity .2s;
    }
    
    .slider:hover {
      opacity: 1;
    }
    
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 25px;
      height: 25px;
      background: #04AA6D;
      cursor: pointer;
    }
    
    .slider::-moz-range-thumb {
      width: 25px;
      height: 25px;
      background: #04AA6D;
      cursor: pointer;
    }
    </style>

<body style="background-color:rgb(201, 191, 191);">
    <div id="foodiv"></div>
    
</body>

<script>
    var sliders = {};
    function createSlider(slid_id,slid_label,minval,maxval,defaultval,step)
    {
        let lab = document.createTextNode(slid_label);
        document.getElementById("foodiv").appendChild(lab);
        let slid1 = document.createElement("input");
        slid1.type = "range";
        slid1.id = slid_id;
        slid1.min = minval;
        slid1.max = maxval;
        slid1.className = "slider";
        if (step!=null)
            slid1.step = step;
        else
            slid1.step = 0.01;
        slid1.value = defaultval;
        // slid1.style = "rangeWrap";
        // slid1.clapchannel = 0;
        slid1.addEventListener("input", updateValue);
        document.getElementById("foodiv").appendChild(slid1);
        let br = document.createElement("br");
        document.getElementById("foodiv").appendChild(br);
        sliders[slid_id] = slid1;
    }
    
    // result from c++ is an async promise! so we need to deal with that like this...
    getParameters([]).then ((result) => 
    { 
        for (var i=0;i<result.length;++i)
        {
            let id = result[i].id;
            createSlider(id,result[i].name,result[i].
              minval,result[i].maxval,result[i].defaultval,result[i].step);
        }
    });

    setInterval(onMyTimer,100);

    function onMyTimer()
    {
      getParameterUpdates([]).then((result) =>
      {
        for (var i=0;i<result.length;++i)
        {
          // console.log(result[i]);
          var id = result[i].id;
          sliders[id].value = result[i].val;
        }
      });     
    }

    function updateValue(e) 
    {
      // console.log("slider moved " + e.target.value);  
      onSliderMoved({id : e.target.id, value : e.target.value});
    }
</script>
</html>
